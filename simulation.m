N = 100;G = zeros(N*N);for i=1:N*N  cnt = 0;  if (i > N)    cnt++;    G(i,i-N) = -1;  endif  if (i <= N*N - N)    cnt++;    G(i,i+N) = -1;  endif  if (mod(i,N) != 1)    cnt++;    G(i,i-1) = -1;  endif  if (mod(i,N) != 0)    cnt++;    G(i,i+1) = -1;  endif  G(i,i) = cnt;  endforGM = inv(G);I = zeros(N*N,1);Nq = ceil(N/8);I(Nq * N + Nq,1) = -1;I(Nq * N + N - Nq,1) = 1;V = G \ I;VM = GM * I;V -= V(1,1);V = reshape(V, N, N);V = V';V /= max(max(V));Jx = zeros(N);dist = 1;for i=1:N  for j=1:N    both = 0;    grad = 0;    if (j > 1)      grad += V(i,j) - V(i,j-1);      both++;    endif    if (j < N)      grad += V(i,j+1) - V(i,j);      both++;    endif        if (both ==2)      grad /= 2;    endif        Jx(i,j) = grad / dist;  endforendforJy = zeros(N);for j=1:N  for i=1:N    both = 0;    grad = 0;    if (i > 1)      grad += V(i,j) - V(i-1,j);      both++;    endif    if (i < N)      grad += V(i+1,j) - V(i,j);      both++;    endif        if (both ==2)      grad /= 2;    endif        Jy(i,j) = grad / dist;  endforendforJ = zeros();for i = 1:N  for j = 1:N    J(i,j) = sqrt(Jx(i,j)*Jx(i,j) + Jy(i,j)*Jy(i,j));  endforendforJ -= min(min(J));J /= max(max(J));Jx -= min(min(Jx));Jx /= max(max(Jx));Jy -= min(min(Jy));Jy /= max(max(Jy));